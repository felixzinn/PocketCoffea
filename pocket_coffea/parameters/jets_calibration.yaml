default_jets_calibration:
  factory_config_clib:
    AK4PFchs:
      2016_PreVFP:
        json_path: ${cvmfs:Run2-2016preVFP-UL-NanoAODv9,JME,jet_jerc.json.gz}
        jec_mc: Summer19UL16APV_V7_MC
        jec_data:
          B: Summer19UL16APV_RunBCD_V7_DATA
          C: Summer19UL16APV_RunBCD_V7_DATA
          D: Summer19UL16APV_RunBCD_V7_DATA
          E: Summer19UL16APV_RunEF_V7_DATA
          F: Summer19UL16APV_RunEF_V7_DATA
        jer: Summer20UL16APV_JRV3_MC
        level: L1L2L3Res

      2016_PostVFP:
        json_path: ${cvmfs:Run2-2016postVFP-UL-NanoAODv9,JME,jet_jerc.json.gz}
        jec_mc: Summer19UL16_V7_MC
        jec_data: Summer19UL16_RunFGH_V7_DATA
        jer: Summer20UL16_JRV3_MC
        level: L1L2L3Res

      "2017":
        json_path: ${cvmfs:Run2-2017-UL-NanoAODv9,JME,jet_jerc.json.gz}
        jec_mc: Summer19UL17_V5_MC
        jec_data:
          B: Summer19UL17_RunB_V5_DATA
          C: Summer19UL17_RunC_V5_DATA
          D: Summer19UL17_RunD_V5_DATA
          E: Summer19UL17_RunE_V5_DATA
          F: Summer19UL17_RunF_V5_DATA
        jer: Summer19UL17_JRV2_MC
        level: L1L2L3Res

      "2018":
        json_path: ${cvmfs:Run2-2018-UL-NanoAODv9,JME,jet_jerc.json.gz}
        jec_mc: Summer19UL18_V5_MC
        jec_data:
          A: Summer19UL18_RunA_V5_DATA
          B: Summer19UL18_RunB_V5_DATA
          C: Summer19UL18_RunC_V5_DATA
          D: Summer19UL18_RunD_V5_DATA
        jer: Summer19UL18_JRV2_MC
        level: L1L2L3Res


    AK4PFPuppi:
      2022_preEE:
        json_path: ${cvmfs:Run3-22CDSep23-Summer22-NanoAODv12,JME,jet_jerc.json.gz}
        jec_mc: Summer22_22Sep2023_V3_MC
        jec_data: Summer22_22Sep2023_RunCD_V3_DATA
        jer: Summer22_22Sep2023_JRV1_MC
        level: L1L2L3Res
      
      2022_postEE:
        json_path: ${cvmfs:Run3-22EFGSep23-Summer22EE-NanoAODv12,JME,jet_jerc.json.gz}
        jec_mc: Summer22EE_22Sep2023_V3_MC
        jec_data:
          E: Summer22EE_22Sep2023_RunE_V3_DATA
          F: Summer22EE_22Sep2023_RunF_V3_DATA
          G: Summer22EE_22Sep2023_RunG_V3_DATA
        jer: Summer22EE_22Sep2023_JRV1_MC
        level: L1L2L3Res

      2023_preBPix:
        json_path: ${cvmfs:Run3-23CSep23-Summer23-NanoAODv12,JME,jet_jerc.json.gz}
        jec_mc: Summer23Prompt23_V2_MC
        jec_data: Summer23Prompt23_V2_DATA
        jer: Summer23Prompt23_RunCv1234_JRV1_MC
        level: L1L2L3Res
      
      2023_postBPix:
        json_path: ${cvmfs:Run3-23DSep23-Summer23BPix-NanoAODv12,JME,jet_jerc.json.gz}
        jec_mc: Summer23BPixPrompt23_V3_MC
        jec_data: Summer23BPixPrompt23_V3_DATA
        jer: Summer23BPixPrompt23_RunD_JRV1_MC
        level: L1L2L3Res

      "2024":
        json_path: ${cvmfs:Run3-24CDEReprocessingFGHIPrompt-Summer24-NanoAODv15,JME,jet_jerc.json.gz}
        jec_mc: Summer24Prompt24_V1_MC
        jec_data: Summer24Prompt24_V1_DATA
        jer: Summer23BPixPrompt23_RunD_JRV1_MC  # For the time being the 2023 jers shall be used https://cms-jerc.web.cern.ch/Recommendations/#2024_1
        level: L1L2L3Res


    AK8PFPuppi:
      2016_PreVFP:
        json_path: ${cvmfs:Run2-2016preVFP-UL-NanoAODv9,JME,fatJet_jerc.json.gz}
        jec_mc: "${default_jets_calibration.factory_config_clib.AK4PFchs.2016_PreVFP.jec_mc}"
        jec_data: "${default_jets_calibration.factory_config_clib.AK4PFchs.2016_PreVFP.jec_data}"
        jer: "${default_jets_calibration.factory_config_clib.AK4PFchs.2016_PreVFP.jer}"
        level: L1L2L3Res

      2016_PostVFP:
        json_path: ${cvmfs:Run2-2016postVFP-UL-NanoAODv9,JME,fatJet_jerc.json.gz}
        jec_mc: "${default_jets_calibration.factory_config_clib.AK4PFchs.2016_PostVFP.jec_mc}"
        jec_data: "${default_jets_calibration.factory_config_clib.AK4PFchs.2016_PostVFP.jec_data}"
        jer: "${default_jets_calibration.factory_config_clib.AK4PFchs.2016_PostVFP.jer}"
        level: L1L2L3Res

      "2017":
        json_path: ${cvmfs:Run2-2017-UL-NanoAODv9,JME,fatJet_jerc.json.gz}
        jec_mc: "${default_jets_calibration.factory_config_clib.AK4PFchs.2017.jec_mc}"
        jec_data: "${default_jets_calibration.factory_config_clib.AK4PFchs.2017.jec_data}"
        jer: "${default_jets_calibration.factory_config_clib.AK4PFchs.2017.jer}"
        level: L1L2L3Res

      "2018":
        json_path: ${cvmfs:Run2-2018-UL-NanoAODv9,JME,fatJet_jerc.json.gz}
        jec_mc: "${default_jets_calibration.factory_config_clib.AK4PFchs.2018.jec_mc}"
        jec_data: "${default_jets_calibration.factory_config_clib.AK4PFchs.2018.jec_data}"
        jer: "${default_jets_calibration.factory_config_clib.AK4PFchs.2018.jer}"
        level: L1L2L3Res

  # factory available variations
  variations:
    full_variations: 
      AK4PFchs:
        2016_PreVFP: 
          - JES_Regrouped_Absolute
          - JES_Regrouped_Absolute_2016
          - JES_Regrouped_FlavorQCD
          - JES_Regrouped_EC2
          - JES_Regrouped_EC2_2016
          - JES_Regrouped_HF
          - JES_Regrouped_HF_2016
          - JES_Regrouped_BBEC1
          - JES_Regrouped_BBEC1_2016
          - JES_Regrouped_RelativeBal
          - JES_Regrouped_RelativeSample_2016
          - JER
        2016_PostVFP:
          - JES_Regrouped_Absolute
          - JES_Regrouped_Absolute_2016
          - JES_Regrouped_FlavorQCD
          - JES_Regrouped_EC2
          - JES_Regrouped_EC2_2016
          - JES_Regrouped_HF
          - JES_Regrouped_HF_2016
          - JES_Regrouped_BBEC1
          - JES_Regrouped_BBEC1_2016
          - JES_Regrouped_RelativeBal
          - JES_Regrouped_RelativeSample_2016
          - JER
        "2017":          
          - JES_Regrouped_Absolute
          - JES_Regrouped_Absolute_2017
          - JES_Regrouped_FlavorQCD
          - JES_Regrouped_EC2
          - JES_Regrouped_EC2_2017
          - JES_Regrouped_HF
          - JES_Regrouped_HF_2017
          - JES_Regrouped_BBEC1
          - JES_Regrouped_BBEC1_2017
          - JES_Regrouped_RelativeBal
          - JES_Regrouped_RelativeSample_2017
          - JER
        "2018":
          - JES_Regrouped_Absolute
          - JES_Regrouped_Absolute_2018
          - JES_Regrouped_FlavorQCD
          - JES_Regrouped_EC2
          - JES_Regrouped_EC2_2018
          - JES_Regrouped_HF
          - JES_Regrouped_HF_2018
          - JES_Regrouped_BBEC1
          - JES_Regrouped_BBEC1_2018
          - JES_Regrouped_RelativeBal
          - JES_Regrouped_RelativeSample_2018
          - JER
      AK8PFPuppi: "${default_jets_calibration.variations.full_variations.AK4PFchs}"
      AK4PFPuppi:
        2022_preEE: 
          - JES_Regrouped_Absolute
          - JES_Regrouped_Absolute_2022
          - JES_Regrouped_FlavorQCD
          - JES_Regrouped_EC2
          - JES_Regrouped_EC2_2022
          - JES_Regrouped_HF
          - JES_Regrouped_HF_2022
          - JES_Regrouped_BBEC1
          - JES_Regrouped_BBEC1_2022
          - JES_Regrouped_RelativeBal
          - JES_Regrouped_RelativeSample_2022
          - JER
        2022_postEE: 
          - JES_Regrouped_Absolute
          - JES_Regrouped_Absolute_2022EE
          - JES_Regrouped_FlavorQCD
          - JES_Regrouped_EC2
          - JES_Regrouped_EC2_2022EE
          - JES_Regrouped_HF
          - JES_Regrouped_HF_2022EE
          - JES_Regrouped_BBEC1
          - JES_Regrouped_BBEC1_2022EE
          - JES_Regrouped_RelativeBal
          - JES_Regrouped_RelativeSample_2022EE
          - JER
        2023_preBPix:      
          - JES_Regrouped_Absolute
          - JES_Regrouped_Absolute_2023
          - JES_Regrouped_FlavorQCD
          - JES_Regrouped_EC2
          - JES_Regrouped_EC2_2023
          - JES_Regrouped_HF
          - JES_Regrouped_HF_2023
          - JES_Regrouped_BBEC1
          - JES_Regrouped_BBEC1_2023
          - JES_Regrouped_RelativeBal
          - JES_Regrouped_RelativeSample_2023
          - JER
        2023_postBPix:      
          - JES_Regrouped_Absolute
          - JES_Regrouped_Absolute_2023BPix
          - JES_Regrouped_FlavorQCD
          - JES_Regrouped_EC2
          - JES_Regrouped_EC2_2023BPix
          - JES_Regrouped_HF
          - JES_Regrouped_HF_2023BPix
          - JES_Regrouped_BBEC1
          - JES_Regrouped_BBEC1_2023BPix
          - JES_Regrouped_RelativeBal
          - JES_Regrouped_RelativeSample_2023BPix
          - JER
        "2024":      
          - JES_Regrouped_Absolute
          - JES_Regrouped_Absolute_2024
          - JES_Regrouped_FlavorQCD
          - JES_Regrouped_EC2
          - JES_Regrouped_EC2_2024
          - JES_Regrouped_HF
          - JES_Regrouped_HF_2024
          - JES_Regrouped_BBEC1
          - JES_Regrouped_BBEC1_2024
          - JES_Regrouped_RelativeBal
          - JES_Regrouped_RelativeSample_2024
          - JER
      
    total_variation: 
      AK4PFchs:
        2016_PreVFP: 
        - JES_Total
        - JER
        2016_PostVFP: 
        - JES_Total
        - JER
        "2017": 
        - JES_Total
        - JER
        "2018": 
        - JES_Total
        - JER
      AK8PFPuppi:
        2016_PreVFP: "${default_jets_calibration.variations.total_variation.AK4PFchs.2016_PreVFP}"
        2016_PostVFP: "${default_jets_calibration.variations.total_variation.AK4PFchs.2016_PostVFP}"
        "2017": "${default_jets_calibration.variations.total_variation.AK4PFchs.2017}"
        "2018": "${default_jets_calibration.variations.total_variation.AK4PFchs.2018}"
      AK4PFPuppi:
        2022_preEE:  
        - JES_Total
        - JER
        2022_postEE: 
        - JES_Total
        - JER
        2023_preBPix:       
        - JES_Total
        - JER
        2023_postBPix: 
        - JES_Total
        - JER
        "2024": 
        - JES_Total
        - JER




#####################################################################################
# Default jets calibration for the user used by the processor
# The user can overwrite `jets_calibration` to get the desired factory.
# The user can build it from the default factory configurations above

jets_calibration:
  jet_types:
    AK4PFchs: "${default_jets_calibration.factory_config_clib.AK4PFchs}" 
    AK4PFPuppi: "${default_jets_calibration.factory_config_clib.AK4PFPuppi}" 
    # AK4PFPuppiPNetRegression: "${default_jets_calibration.factory_config_clib.AK4PFPuppiPNetRegression}" 
    # AK4PFPuppiPNetRegressionPlusNeutrino: "${default_jets_calibration.factory_config_clib.AK4PFPuppiPNetRegressionPlusNeutrino}" 
    AK8PFPuppi: "${default_jets_calibration.factory_config_clib.AK8PFPuppi}"
    
  collection:  # this is needed to know which collection is corrected with which jet factory
    2016_PreVFP:
      AK4PFchs: "Jet"
      AK8PFPuppi: "FatJet"
    2016_PostVFP:
      AK4PFchs: "Jet"
      AK8PFPuppi: "FatJet"
    "2017":
      AK4PFchs: "Jet"
      AK8PFPuppi: "FatJet"
    "2018":
      AK4PFchs: "Jet"
      AK8PFPuppi: "FatJet"
    2022_preEE:
      AK4PFPuppi: "Jet"
      #AK8PFPuppi: "FatJet"
      #AK4PFPuppiPNetRegression: "Jet"
      #AK4PFPuppiPNetRegressionPlusNeutrino: "Jet"
      
    2022_postEE:
      AK4PFPuppi: "Jet"
      #AK8PFPuppi: "FatJet"
      #AK4PFPuppiPNetRegression: "Jet"
      #AK4PFPuppiPNetRegressionPlusNeutrino: "Jet"

    2023_preBPix:
      AK4PFPuppi: "Jet"
      #AK8PFPuppi: "FatJet"
      #AK4PFPuppiPNetRegression: "Jet"
      #AK4PFPuppiPNetRegressionPlusNeutrino: "Jet"
      
    2023_postBPix:
      AK4PFPuppi: "Jet"
      #AK8PFPuppi: "FatJet"
      #AK4PFPuppiPNetRegression: "Jet"
      #AK4PFPuppiPNetRegressionPlusNeutrino: "Jet"

    "2024":
      AK4PFPuppi: "Jet"
      #AK8PFPuppi: "FatJet"
      #AK4PFPuppiPNetRegression: "Jet"
      #AK4PFPuppiPNetRegressionPlusNeutrino: "Jet"


  sort_by_pt:
    2016_PreVFP:
      AK4PFchs: True
      AK8PFPuppi: True
    2016_PostVFP:
      AK4PFchs: True
      AK8PFPuppi: True  
    "2017":
      AK4PFchs: True
      AK8PFPuppi: True
    "2018":
      AK4PFchs: True
      AK8PFPuppi: True    
    2022_preEE:
      AK4PFPuppi: True
      #AK8PFPuppi: True
      #AK4PFPuppiPNetRegression: True
      #AK4PFPuppiPNetRegressionPlusNeutrino: True
    2022_postEE:
      AK4PFPuppi: True
      #AK8PFPuppi: True
      #AK4PFPuppiPNetRegression: True
      #AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_preBPix:
      AK4PFPuppi: True
      #AK8PFPuppi: True
      #AK4PFPuppiPNetRegression: True
      #AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_postBPix:
      AK4PFPuppi: True
      #AK8PFPuppi: True
      #AK4PFPuppiPNetRegression: True
      #AK4PFPuppiPNetRegressionPlusNeutrino: True
    "2024":
      AK4PFPuppi: True
      #AK8PFPuppi: True
      #AK4PFPuppiPNetRegression: True
      #AK4PFPuppiPNetRegressionPlusNeutrino: True

  
  apply_jec_MC:  # this is needed to know which collection is corrected with which jet factory
    2016_PreVFP: 
      AK4PFchs: True
      AK8PFPuppi: True
    2016_PostVFP: 
      AK4PFchs: True
      AK8PFPuppi: True
    "2017": 
      AK4PFchs: True
      AK8PFPuppi: True
    "2018": 
      AK4PFchs: True
      AK8PFPuppi: True
    2022_preEE: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2022_postEE: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_preBPix: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_postBPix: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    "2024": 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True

  apply_jer_MC:  # this is needed to know which collection is corrected with which jet factory
    2016_PreVFP: 
      AK4PFchs: True
      AK8PFPuppi: True
    2016_PostVFP: 
      AK4PFchs: True
      AK8PFPuppi: True
    "2017": 
      AK4PFchs: True
      AK8PFPuppi: True
    "2018": 
      AK4PFchs: True
      AK8PFPuppi: True
    2022_preEE: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2022_postEE: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_preBPix: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_postBPix: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    "2024": 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True

  apply_jec_Data:  # this is needed to know which collection is corrected with which jet factory
    2016_PreVFP: 
      AK4PFchs: False
      AK8PFPuppi: False
    2016_PostVFP: 
      AK4PFchs: False
      AK8PFPuppi: False
    "2017": 
      AK4PFchs: False
      AK8PFPuppi: False
    "2018": 
      AK4PFchs: False
      AK8PFPuppi: False
    2022_preEE: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2022_postEE: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_preBPix: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_postBPix: 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    "2024": 
      AK4PFPuppi: True
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True

  #  Default configuration for pt Regression  **before** JEC
  apply_pt_regr_MC:
    2016_PreVFP: 
      AK4PFchs: False
      AK8PFPuppi: False
    2016_PostVFP: 
      AK4PFchs: False
      AK8PFPuppi: False
    "2017": 
      AK4PFchs: False
      AK8PFPuppi: False
    "2018": 
      AK4PFchs: False
      AK8PFPuppi: False
    2022_preEE: 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2022_postEE: 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_preBPix: 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_postBPix: 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    "2024": 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True

  apply_pt_regr_Data:
    2016_PreVFP: 
      AK4PFchs: False
      AK8PFPuppi: False
    2016_PostVFP: 
      AK4PFchs: False
      AK8PFPuppi: False
    "2017": 
      AK4PFchs: False
      AK8PFPuppi: False
    "2018": 
      AK4PFchs: False
      AK8PFPuppi: False
    2022_preEE: 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2022_postEE: 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_preBPix: 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    2023_postBPix: 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True
    "2024": 
      AK4PFPuppi: False
      AK4PFPuppiPNetRegression: True
      AK4PFPuppiPNetRegressionPlusNeutrino: True


  rescale_MET_config:
    2016_PreVFP:
      apply: True
      MET_collection: "MET"
      Jet_collection: "Jet"
    2016_PostVFP:
      apply: True
      MET_collection: "MET"
      Jet_collection: "Jet"
    "2017":
      apply: True
      MET_collection: "MET"
      Jet_collection: "Jet"
    "2018": 
      apply: True
      MET_collection: "MET"
      Jet_collection: "Jet"
    2022_preEE:   
      apply: True
      MET_collection: "PuppiMET"
      Jet_collection: "Jet"
    2022_postEE:
      apply: True
      MET_collection: "PuppiMET"
      Jet_collection: "Jet"
    2023_preBPix:
      apply: True
      MET_collection: "PuppiMET"
      Jet_collection: "Jet"
    2023_postBPix:
      apply: True
      MET_collection: "PuppiMET"
      Jet_collection: "Jet"
    "2024":
      apply: True
      MET_collection: "PuppiMET"
      Jet_collection: "Jet"


    
  
  # By default only the total variations are included
  # The user can customize the wanted variations by changing the variations key in the user parameters.
  # the key default_jets_calibration.variations.full_variations contains the full setup of JET variations.
  # setup `jets_calibration.variations == "${default_jets_calibration.variations.full_variations}"` to use all variations
  # variations: "${default_jets_calibration.variations.full_variations}"
  variations: "${default_jets_calibration.variations.total_variation}"
